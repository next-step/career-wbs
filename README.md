# 🪴 career-WBS
- 이름: 박상권

# 🚀미션
- 결제 취소 기능 마이그레이션

## AS-IS
### 개선포인트 분석
- 취소 기능에 대한 레거시 코드에서 계속해서 취소 기능에 대한 개발이 이루어져 현재 유지보수가 불가한 상태
- 이 상태에서도 추가적인 개발이 일어나면 취소 기능은 어쩔 수 없이 기능 개발이 일어나고 있는 상태
- 그로인해서 취소 기능과 관련된 여러 장애가 발생해도 걷잡을 수 없는 상태

### 프로세스
flowchart TB
A[Start] -- 결제 취소 요청 -> B[가맹점 요청 파라미터 검사]
B --> C[가맹점 조회]
C --> D[승인 거래 조회]
C --> E[취소 금액 계산]
E --> F[결제 취소 진행]
F --> G[결제사 측으로 결제 취소 API 요청]
H --> H[취소 API 응답에 대한 DB 후 처리 진행]

### Before class diagram
- WBS-pawoo0211-Class.md

### Before ERD
- WBS-pawoo0211-ERD.md


## TO-BE 
### 기대효과 분석
- JSP와 JDBC Template을 이용한 코드에서 스프링 부트와 MyBatis, JPA 적용
- 메서드 하나에 존재하는 수백 라인의 코드 단축으로 인한 가시성 향상
- 취소 기능에 대한 유지 보수성 증가
- 새로운 결제 수단이 추가될 때마다 공통화 된 취소 기능을 사용하여 빠른 개발 진행

### 기술적용 아키텍쳐
flowchart TB
A,B[Spring boot]
C,D[JPA]
E,F,G[Spring boot]
H[My Batis]

    A[Start] -- 결제 취소 요청 -> B[가맹점 요청 파라미터 검사]
    B --> C[가맹점 조회]
    C --> D[승인 거래 조회]
    C --> E[취소 금액 계산]
    E --> F[결제 취소 진행]
    F --> G[결제사 측으로 결제 취소 API 요청]
    H --> H[취소 API 응답에 대한 DB 후 처리 진행]

### After class diagram
- 신규 서버의 소스 코드 분석에 따라 점진적으로 클래스 모델링 진행 예정

### After ERD
- 기존 ERD와 동일

## Task List
1. Timeout 발생 시 Event발생 수정- SQS, SNS <br>
2. Timeout event subscription module 작성<br>
3. Timeout log table 설계, 생성<br>
4. Timeout 재처리 service 설개, 구현<br>
&nbsp; &nbsp; 1. transaction 성공여부 확인 <br>
&nbsp; &nbsp; 2. transaction 취소 처리 하기 (결제시)<br>
&nbsp; &nbsp; 3. 재처리 logging(DB) : 처리 횟수(3회), 처리 내역<br>
5. Timeout 재처리 현황 조회 어드민 page.<br>
6. Timeout 재처리 실패시 메일 발송 모듈.<br>

## WBS
- 요구사항 분석: 이미 수행
- 도메인 분석: 이미 수행
- 일정 산정: 이미 수행
1. 결제 취소 시 레거시 서버에서 신규 서버로 연결 작업 진행-3d(2023-12-13~15)
2. 결제 취소에 대한 요청 파라미터 검증-2d(2023-12-18~19)
3. 가맹점 정보 조회-3d(2023-12-20~22)
4. 승인 거래 조회-2d(2023-12-26~27)
5. 취소 가능한 승인 거래인지 검증 및 예외 처리-2d(2023-12-28~29)
6. 취소 금액 계산-4d(2024-01-02~05)
7. 취소 금액 저장-1d(2024-01-08)
8. 취소 진행에 따른 카드 매입사 취소 요청-4d(2024-01-09~12, 방화벽 설정 포함 기간)
9. 취소 응답에 따른 DB 후 처리-1d(2024-01-15)
10. 취소 메일 HTML 전송-4d(2024-01-16~20)
11. 실 결제 취소 테스트에 따른 보완 작업 진행-10d(2024-01-22~2024-02-02)
